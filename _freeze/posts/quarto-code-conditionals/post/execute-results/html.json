{
  "hash": "1c077de36325a31f0915acdf8a7d9d83",
  "result": {
    "markdown": "---\ntitle: \"Publishing content in Quarto using conditionals and if/else code flow\"\ndescription: \"A selection of simple methods using the knitr engine and HTML output\"\nauthor:\n  - name: Jim Gardner\n    url: https://jimgar.github.io/jimgar/\ndate: 2023-04-24\ncategories: [Quarto, R, knitr]\nexecute:\n  echo: false\ndraft: false\n---\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n<style type=\"text/css\">\n.figure-caption {\n    text-align: center;\n}\n</style>\n:::\n\n\n![Damsel the chimera. Copyright Andy Stacey.](images/damsel1.png){fig-alt=\"A cropped photograph of the eyes and surrounding fur of a cat's face. The cat is a chimera with green eyes, the left side of her face coloured black and the right side orange. The cat's name is Damsel.\" width=80%}\n\nIn this post I will describe some of the ways I've found to conditionally include content in a Quarto-generate HTML document.\n\nI'm using RStudio and the knitr rendering engine. If you know of Jupyter solutions please let me know! I will happily link to them for the disappointed Pythonistas who have ended up on my blog ;)\n\n# Quarto\n\n## The {{{< include >}}} shortcode\n\nThis isn't conditional, but it is really useful. \n\nIf you have company marketing boilerplate, or headers that start all of your reports, a neat solution is to keep these in their own qmd file and bring them into any other qmd using the [include shortcode](https://quarto.org/docs/authoring/includes.html).\n\nIn your report you would use the code below\n\n``` {.markdown shortcodes=\"false\"}\n{{< include _content.qmd >}}\n```\n\nThis is akin to manually copying and pasting in the contents of `content.qmd` prior to the report getting rendered.\n\nWe'll come back to the shortcode later.\n\n## Conditional content\n\nTo my mind this one unfairly hogs the \"conditional\" title.\n\nThis is for when you have parts of a document that you only want rendered (or not) to a specific **format**, such as HTML, PDF, etc.\n\nIf you're interested in this, here's the [Quarto guide](https://quarto.org/docs/authoring/conditional.html).\n\n## Project profiles\n\nIn this scenario you will have content to be included (or excluded) based on the profile/s specified. The div below would only be included if the \"advanced\" profile is in use\n\n``` {.markdown}\n::: {.content-visible when-profile=\"advanced\"}\nThis content will only appear in the advanced version.\n:::\n```\n\nYou can also specify configurations in a profile-specific YAML that can be fully, or selectively used, to override those in the default profile. Here are [the docs.](https://quarto.org/docs/projects/profiles.html)\n\n# Code flow\n\nMost of the following examples follow the usual if/else structure.\n\nI'll be referring to `params$my_boolean` throughout this section so let me take a moment to explain. \n\nIn the YAML header of a Quarto document you can pass in parameters. These get stored in a list `params` that can be called throughout the document, just like any variables you make and keep in the global environment.\n\n``` {.markdown}\n---\nparams:\n  my_boolean: FALSE\n---\n```\n\nReports made this way are known as [parameterised reports](https://quarto.org/docs/computations/parameters.html).\n\nIf you're using a Quarto project it is also possible to include variables in a root directory file `_variables.yml`. I'm not doing that here, but if it sounds appropriate for you, [here are the docs](https://quarto.org/docs/authoring/variables.html).\n\n## Inline code\n\nYou can conditionally execute inline code. If `my_boolean` is `TRUE` the example below results in a level 2 heading that says \"Plots for mtcars\". \n\n```{.markdown}\n## Plots `r if (params$my_boolean) \"for mtcars\" else \"for iris\"`\n```\n\n## In functions\n\nSometimes you just need a bit of perspective. Rather than something convoluted, do you just need to make a function with flow control of some kind?\n\n\n\n```{.r .cell-code}\nplotting_func <- function(dat, col1, col2) {\n  \n  if (params$my_boolean) {\n    \n    dat |>\n      ggplot2::ggplot() +\n      ggplot2::geom_point(ggplot2::aes({{ col1 }}, {{ col2 }}))\n    \n  } else {\n    \n    dat |>\n      ggplot2::ggplot() +\n      ggplot2::geom_boxplot(ggplot2::aes({{ col1 }}, {{ col2 }}))\n    \n  }\n  \n}\n```\n\n\nOr if the content is amenable to it, something like this\n\n\n\n```{.r .cell-code}\nplotting_func <- function(dat, col1, col2) {\n  \n  dat |>\n    ggplot2::ggplot() +\n    if (params$my_boolean) {\n      ggplot2::geom_point(ggplot2::aes({{ col1 }}, {{ col2 }}))\n    } else {\n      ggplot2::geom_boxplot(ggplot2::aes({{ col1 }}, {{ col2 }}))\n    }\n  \n}\n```\n\n\nYou could put the function into a code block. Or you could hide it away in a folder `R/` and a script `functions.R`. That's useful if you write long ugly functions like me (lol), but also if you have multiple functions. In this case, you could just source the functions silently along with library calls at the start of the Quarto doc.\n\n```{{r}}\n#| include: false\nlibrary(dplyr)\nlibrary(downloadthis)\nlibrary(reactable)\nsource(file.path(\"R\", \"functions.R\"))\n```\n\nIf your content is too complicated for flow control inside of a function, then just put the content into separate functions in `functions.R`, `source` them as above, and use flow control in the Quarto doc\n\n```{{r}}\nif (params$my_boolean) {\n  fancy_model_a(mtcars, wt, mpg) \n} else {\n  fancy_model_b(iris, Species, Sepal.Length)\n}\n```\n\n## knitr::knit_child\n\nSaving the best for last, because this one is really cool!\n\nRemember how I started with the `{{{< include >}}}` shortcode and said that it wasn't conditional?\n\n``` {.markdown shortcodes=\"false\"}\n{{< include _content.qmd >}}\n```\n\nIf anyone knows how to (simply) use the shortcode in a conditional manner I'd love to hear about it. In the meantime I consider the conditional version of this is using `knitr::knit_child`.\n\nLet's say I make interactive plots of my data using Observable code blocks and keep this code in a separate Quarto doc `ojs-cells.qmd`. The code can be added to the main Quarto doc under certain conditions, as dictated by a boolean param `ojs_include` in the YAML header\n\n```{{r}}\n#| output: asis\nif (params$ojs_include) { \n  \n  cat(sep = \"\\n\",\n      knitr::knit_child(quiet = TRUE,\n                        text = readr::read_file(\"ojs-cells.qmd\")\n      )\n  )\n  \n}\n```\n\nWhat's happening here is \n\n1) `readr::read_file` brings in `ojs-cells.qmd` as a string\n2) `cat` restores the line-by-line formatting and 'prints' the content\n3) The `output: asis` chunk option means Quarto treats the content as raw markdown output \n\nWorth a mention - though not about conditionality - is this [demo](https://mickael.canouil.fr/posts/2023-03-05-quarto-auto-table-crossref/) by MickaÃ«l Canouil. It shows how the `knit_child` method can be called in a for loop to create *n* code chunks, and therefore *n* outputs (like tables and plots). This is great when you don't know how many plots there will be or even what they are called.\n\n# Summary\n\n![Damsel the chimera. Copyright me!](images/damsel2.JPG){fig-alt=\"A blurry, close-up photograph of a cat's face, taken unflatteringly from below. Her mouth is slightly ajar and the overall look is goofy. The cat is a chimera with green eyes, the left side of her face coloured black and the right side orange. The cat's name is Damsel.\" width=80%}\n\nI hope these approaches give you a practical set of tools for including conditional content in Quarto-published HTML documents.\n\nYou can use\n\n1) The shortcode `{{{< include >}}}` to bring in a sub-document\n2) Publish content dependent on output format using \"conditional content\"\n\n3) if/else statements either inline or in code chunks. This can be combined with \n    1) Functional programming by putting code into functions - either in code blocks in the document, or in a separate sourced file \n    2) With knitr's `knit_child` to bring in entire sub-documents as required\n    \nThank you to [Bruno Rodrigues](brodrigues.co) and [John MacKintosh](johnmackintosh.net) for proofreading a draft of this post.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}